<div class="container">

	<!-- Winner form -->

	<div class="jumbotron" ng-if = "bets.showTopForm">
		<div class="row">
			<div class="col-xs-12">
				<form class="" name="topForm" ng-submit="bets.addWinnerAndScorer(bets.topForm)" autocomplete="off">
					<div class="form-group col-xs-12">
						<h2>Tippeld meg a győztest és a gólkirályt!</h2>
					</div>
					<div class="form-group col-xs-12 col-sm-6" ng-class="{'has-error': topForm.winner.$invalid && topForm.winner.$touched}">
						<input
							required
							name="winner"
							list-to-validate = "teams" 
							type="text" 
							class="form-control input-lg" 
							uib-typeahead="team as team.longName for team in bets.data.teams | filter: {longName: $viewValue}" 
							ng-model="bets.topForm.winner"
							placeholder="Győztes"
							ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 300, 'blur': 0 } }">
						<div ng-messages = "topForm.winner.$error" ng-if="topForm.winner.$touched">
							<p class="help-block" ng-message="required">Ne felejtsd el megadni a győztest</p>
							<p class="help-block" ng-message="listToValidate">Nincs ilyen csapat az adatbázisban</p>
						</div>
					</div>
					<div class="form-group col-xs-12 col-sm-6" ng-class="{'has-error': topForm.scorer.$invalid && topForm.scorer.$touched}">
						<input 
							required
							name="scorer"
							list-to-validate = "players"
							type="text" 
							class="form-control input-lg" 
							uib-typeahead="player as player.name for player in bets.data.players | filter: {name: $viewValue}" 
							ng-model="bets.topForm.topScorer"
							placeholder="Gólkirály"
							ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 300, 'blur': 0 } }">
						<div ng-messages = "topForm.scorer.$error" ng-if="topForm.scorer.$touched">
							<p class="help-block" ng-message="required">Ne felejtsd el megadni a gólkirályt</p>
							<p class="help-block" ng-message="listToValidate">Nincs ilyen játékos az adatbázisban</p>
						</div>
					</div>
					<div class="form-group col-xs-12 col-sm-12">
						<p class="help-block">Ezeket a tippeket az első meccs kezdetéig még akármikor módosíthatod.</p>
					</div>
					<div class="form-group col-xs-12 col-sm-12">
						<span class="pull-right">
							<button type="reset" class="btn btn-lg btn-default" ng-click = "bets.showTopForm = false">Mégse</button>
							<button type="submit" class="btn btn-lg btn-primary" ng-disabled="topForm.$invalid">Mentés</button>
						</span>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Winner bets -->
	
	<div class="row" ng-if="!bets.showTopForm">

		<div class="col-xs-12 well" ng-show="bets.user.bets.winner || bets.user.bets.topScorer">
			<strong ng-show="bets.user.bets.winner || bets.user.bets.topScorer">Favoritok:</strong> 
			<span ng-show="bets.user.bets.winner">
				<span class="flag-icon" ng-class="{'flag-icon-{{bets.user.bets.winner.ISO}}': true}"></span> <strong>{{bets.user.bets.winner.longName}}</strong> lesz az Európa-bajnok, és
			</span>
			<span ng-show="bets.user.bets.topScorer">
				<span class="flag-icon" ng-class="{'flag-icon-hu': true}"></span> <strong>{{bets.user.bets.topScorer.name}}</strong> a gólkirály.
			</span>
			<a ng-show="bets.user.bets.winner || bets.user.bets.topScorer" href class="pull-right" ng-click="bets.showTopForm = true; bets.loadBets()">Módosítom</a>
		</div>

		<!-- Empty state -->

		<div class="alert alert-danger" ng-hide="bets.user.bets.winner || bets.user.bets.topScorer">
			<span>
				Még nem tippeltél a győztesre és a gólkirályra! 
			</span>
			<a href class="alert-link" ng-click="bets.showTopForm = true">Kattints ide a tippeléshez!</a>
		</div>
	</div>

	<!-- Match bets -->

	<div class="row">
		<div class="col-xs-12">
			<h3>Meccsek<br>	
			<small>A tippedet még megváltoztathatod, legkésőbb a meccs kezdete előtt {{bets.timeLimit / 60000}} perccel. Kattints a tippre a módosításhoz!</small></h3>
				<div class="checkbox checkbox-lg">
					<label>
						<input type="checkbox" ng-model="bets.onlyOpen">Csak <span class="label label-info"><span class="glyphicon glyphicon-pencil"></span> Nyitott</span> meccsek
					</label>
				</div>
		</div>
		<div 
		class="col-xs-12 match-block" 
		ng-repeat="match in bets.data.matches | orderBy: 'datetime' | open: bets.onlyOpen : bets.now">

			<div class="col-sm-10">
				<h4>
					<span class="label label-info" ng-show="bets.now < match.datetime - bets.timeLimit && !match.result"><span class="glyphicon glyphicon-pencil"></span> Nyitott</span>
					<span class="label label-default" ng-show="bets.now > match.datetime - bets.timeLimit && !match.result"><span class="glyphicon glyphicon-ban-circle"></span> Lezárt</span>
					<span class="label label-primary" ng-show="match.result"><span class="glyphicon glyphicon-ok"></span> Eredmény</span>
					<small ng-show="bets.now < match.datetime - bets.timeLimit && !match.result"> {{match.datetime | date: 'MM.dd., H:mm'}}</small>
				</h4>
			</div>
			<div class="col-xs-12 col-sm-10">
				<h3>
					<span class="flag-icon" ng-class="{'flag-icon-{{match.home.ISO}}': true}"></span>&nbsp{{match.home.longName}} - {{match.away.longName}}
					<span class="flag-icon" ng-class="{'flag-icon-{{match.away.ISO}}': true}"></span>
				</h3>
			</div>
			<div class="col-xs-12 col-sm-2 text-center">
				<h3 ng-hide = "bets.now > match.datetime - bets.timeLimit || match.result">
					<a href ng-click="bets.inputs[match.$id] = true; bets.loadMatchBet(bets.user.bets.matches[match.$id], match.$id)" ng-hide="bets.inputs[match.$id]">
						<span ng-show="bets.user.bets.matches[match.$id]">
							{{bets.user.bets.matches[match.$id].home}} - 
							{{bets.user.bets.matches[match.$id].away}}
						</span>
					</a>
					<input
						ng-if="bets.inputs[match.$id] || !bets.user.bets.matches[match.$id]"  
						name="matchBet"
						size="3"
						class="form-control bet-input"
						type="text" 
						eb-focus="bets.inputs[match.$id]"
						ng-model="bets.matchBet[match.$id]"
						ng-blur="bets.updateBet(bets.matchBet[match.$id], match.$id)"
						placeholder="Ide írd a tipped"
						ng-keypress="bets.submitBetOnEnter($event, bets.matchBet[match.$id], match.$id)">
				</h3>
				<h3 ng-show="bets.now > match.datetime - bets.timeLimit && !match.result">
					<span ng-show="bets.user.bets.matches[match.$id]">
						{{bets.user.bets.matches[match.$id].home}} - 
						{{bets.user.bets.matches[match.$id].away}})
					</span>
					<small ng-hide="bets.user.bets.matches[match.$id]">Nem tippeltél</small>
				</h3>
				<h3>
					<span class="label label-success" ng-show="bets.user.bets.matches[match.$id].points"><span class="glyphicon glyphicon-ok"></span> {{bets.user.bets.matches[match.$id].points}} pont</span>
					<span class="label label-default" ng-hide="bets.user.bets.matches[match.$id].points || !match.result"><span class="glyphicon glyphicon-remove"></span> 0 pont</span>
				</h3>
			</div>
			<div class="col-xs-12" >
				<h5 ng-show="match.result" class="help-block">
					{{match.result.home}} - {{match.result.away}} 
					<span ng-show="bets.user.bets.matches[match.$id]">
						(Tipped: 
						{{bets.user.bets.matches[match.$id].home}} - 
						{{bets.user.bets.matches[match.$id].away}})
					</span>
					<span ng-hide="bets.user.bets.matches[match.$id]">(Nem tippeltél)</span>
				</h5>
			</div>
		</div>
	</div>
</div>

